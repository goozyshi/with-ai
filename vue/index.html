<!DOCTYPE html>
<html>
  <head>
    <title>ç¬¬1ç« æƒè¡¡çš„è‰ºæœ¯-å®è·µéªŒè¯</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .demo-section {
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px 0;
      }
      .performance-result {
        color: #007acc;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Vueè®¾è®¡æƒè¡¡éªŒè¯å®éªŒ</h1>

    <!-- å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼æ€§èƒ½å¯¹æ¯” -->
    <div class="demo-section">
      <h2>å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼</h2>
      <div id="imperative-result"></div>
      <div id="declarative-result"></div>
    </div>

    <!-- å®éªŒ2ï¼šè™šæ‹ŸDOM vs innerHTML -->
    <div class="demo-section">
      <h2>å®éªŒ2ï¼šè™šæ‹ŸDOMæ¦‚å¿µ vs innerHTML</h2>
      <div id="virtual-dom-demo"></div>
      <div id="inner-html-demo"></div>
    </div>

    <!-- å®éªŒ3ï¼šç¼–è¯‘æ—¶ vs è¿è¡Œæ—¶å¯¹æ¯” -->
    <div class="demo-section">
      <h2>å®éªŒ3ï¼šç¼–è¯‘æ—¶+è¿è¡Œæ—¶çš„ä»·å€¼</h2>
      <div id="compile-runtime-demo"></div>
    </div>

    <script>
      console.log("ğŸš€ å¼€å§‹éªŒè¯Vueè®¾è®¡æƒè¡¡...");

      // ===== å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼ =====
      const testData = Array.from({ length: 1000 }, (_, i) => ({
        id: i,
        name: `ç”¨æˆ·${i}`,
        status: i % 2 === 0 ? "åœ¨çº¿" : "ç¦»çº¿",
      }));

      // å‘½ä»¤å¼å®ç°
      function imperativeRender(data, container) {
        console.time("å‘½ä»¤å¼è€—æ—¶");
        container.innerHTML = "";
        const ul = document.createElement("ul");

        data.forEach((item) => {
          const li = document.createElement("li");
          li.className = item.status === "åœ¨çº¿" ? "online" : "offline";
          li.textContent = `${item.name} - ${item.status}`;
          ul.appendChild(li);
        });

        container.appendChild(ul);
        console.timeEnd("å‘½ä»¤å¼è€—æ—¶");
      }

      // å£°æ˜å¼å®ç°ï¼ˆæ¨¡æ‹Ÿï¼‰
      function declarativeRender(data, container) {
        console.time("å£°æ˜å¼è€—æ—¶");
        const template = data
          .map(
            (item) =>
              `<li class="${item.status === "åœ¨çº¿" ? "online" : "offline"}">
          ${item.name} - ${item.status}
        </li>`
          )
          .join("");

        container.innerHTML = `<ul>${template}</ul>`;
        console.timeEnd("å£°æ˜å¼è€—æ—¶");
      }

      // æ‰§è¡Œå¯¹æ¯”
      imperativeRender(testData, document.getElementById("imperative-result"));
      declarativeRender(
        testData,
        document.getElementById("declarative-result")
      );

      // ===== å®éªŒ2ï¼šè™šæ‹ŸDOMæ¦‚å¿µéªŒè¯ =====
      // æ¨¡æ‹Ÿè™šæ‹ŸDOMç»“æ„
      const VNode = {
        tag: "div",
        props: { class: "container" },
        children: [
          { tag: "h3", children: ["è™šæ‹ŸDOMçš„ä¼˜åŠ¿"] },
          { tag: "p", children: ["1. å¯é¢„æµ‹çš„æ›´æ–°"] },
          { tag: "p", children: ["2. è·¨å¹³å°èƒ½åŠ›"] },
          { tag: "p", children: ["3. ç»„ä»¶åŒ–æ”¯æŒ"] },
        ],
      };

      // ç®€å•çš„è™šæ‹ŸDOMæ¸²æŸ“å™¨
      function renderVNode(vnode) {
        if (typeof vnode === "string") return document.createTextNode(vnode);

        const el = document.createElement(vnode.tag);

        if (vnode.props) {
          Object.entries(vnode.props).forEach(([key, value]) => {
            el.setAttribute(key, value);
          });
        }

        if (vnode.children) {
          vnode.children.forEach((child) => {
            el.appendChild(renderVNode(child));
          });
        }

        return el;
      }

      document
        .getElementById("virtual-dom-demo")
        .appendChild(renderVNode(VNode));

      // innerHTMLå¯¹æ¯”
      document.getElementById("inner-html-demo").innerHTML = `
      <div class="container">
        <h3>innerHTMLæ–¹å¼</h3>
        <p>1. ç®€å•ç›´æ¥</p>
        <p>2. æ€§èƒ½æ›´å¥½ï¼ˆå•æ¬¡æ¸²æŸ“ï¼‰</p>
        <p>3. ä½†éš¾ä»¥åšç²¾å‡†æ›´æ–°</p>
      </div>
    `;

      // ===== å®éªŒ3ï¼šç¼–è¯‘æ—¶+è¿è¡Œæ—¶çš„ä»·å€¼ =====
      // æ¨¡æ‹Ÿç¼–è¯‘æ—¶ä¼˜åŒ–
      const compiledTemplate = {
        // ç¼–è¯‘æ—¶å·²çŸ¥çš„é™æ€éƒ¨åˆ†
        staticParts: ['<div class="user-card"><h3>', "</h3><p>çŠ¶æ€: "],
        // è¿è¡Œæ—¶åŠ¨æ€éƒ¨åˆ†çš„ä½ç½®
        dynamicSlots: [0, 1], // name, status
        // ç¼–è¯‘æ—¶ç”Ÿæˆçš„ä¼˜åŒ–æ¸²æŸ“å‡½æ•°
        render: function (data) {
          return `${this.staticParts[0]}${data.name}${this.staticParts[1]}${data.status}</p></div>`;
        },
      };

      // çº¯è¿è¡Œæ—¶æ–¹å¼ï¼ˆéœ€è¦è¿è¡Œæ—¶è§£æï¼‰
      function pureRuntime(template, data) {
        console.time("çº¯è¿è¡Œæ—¶");
        const result = template.replace(
          /\{\{(\w+)\}\}/g,
          (match, key) => data[key]
        );
        console.timeEnd("çº¯è¿è¡Œæ—¶");
        return result;
      }

      // ç¼–è¯‘æ—¶+è¿è¡Œæ—¶æ–¹å¼
      function compileRuntime(compiled, data) {
        console.time("ç¼–è¯‘æ—¶+è¿è¡Œæ—¶");
        const result = compiled.render(data);
        console.timeEnd("ç¼–è¯‘æ—¶+è¿è¡Œæ—¶");
        return result;
      }

      // æµ‹è¯•æ•°æ®
      const userData = { name: "å¼ ä¸‰", status: "åœ¨çº¿" };
      const pureTemplate =
        '<div class="user-card"><h3>{{name}}</h3><p>çŠ¶æ€: {{status}}</p></div>';

      // æ‰§è¡Œæµ‹è¯•
      const demo3Container = document.getElementById("compile-runtime-demo");
      demo3Container.innerHTML = `
      <h4>çº¯è¿è¡Œæ—¶ç»“æœ:</h4>
      ${pureRuntime(pureTemplate, userData)}
      <h4>ç¼–è¯‘æ—¶+è¿è¡Œæ—¶ç»“æœ:</h4>
      ${compileRuntime(compiledTemplate, userData)}
      <p class="performance-result">æŸ¥çœ‹æ§åˆ¶å°å¯¹æ¯”æ€§èƒ½å·®å¼‚</p>
    `;

      // ğŸ¤” æ€è€ƒé¢˜è¾“å‡º
      console.log(`
    ğŸ¤” æ€è€ƒé¢˜ï¼š
    1. ä»æ€§èƒ½æµ‹è¯•ç»“æœçœ‹ï¼Œæ‚¨è®¤ä¸ºVueé€‰æ‹©å£°æ˜å¼çš„ä¸»è¦åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ
    2. è™šæ‹ŸDOMç›¸æ¯”ç›´æ¥DOMæ“ä½œï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼˜åŠ¿æœ€æ˜æ˜¾ï¼Ÿ
    3. ç¼–è¯‘æ—¶+è¿è¡Œæ—¶çš„æ¶æ„ï¼Œåœ¨æ‚¨çš„å®é™…é¡¹ç›®ä¸­æœ‰å“ªäº›åº”ç”¨åœºæ™¯ï¼Ÿ
    
    è¯·åœ¨å­¦ä¹ ç¬”è®°ä¸­è®°å½•æ‚¨çš„ç­”æ¡ˆ...
    `);
    </script>
  </body>
</html>
