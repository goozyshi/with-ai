<!DOCTYPE html>
<html>
  <head>
    <title>ç¬¬1ç« æƒè¡¡çš„è‰ºæœ¯-å®è·µéªŒè¯</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .demo-section {
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px 0;
      }
      .performance-result {
        color: #007acc;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Vueè®¾è®¡æƒè¡¡éªŒè¯å®éªŒ</h1>

    <!-- å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼æ€§èƒ½å¯¹æ¯” -->
    <div class="demo-section">
      <h2>å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼</h2>
      <div id="imperative-result"></div>
      <div id="declarative-result"></div>
    </div>

    <!-- å®éªŒ2ï¼šè™šæ‹ŸDOM vs innerHTML -->
    <div class="demo-section">
      <h2>å®éªŒ2ï¼šè™šæ‹ŸDOMæ¦‚å¿µ vs innerHTML</h2>
      <div id="virtual-dom-demo"></div>
      <div id="inner-html-demo"></div>
    </div>

    <!-- å®éªŒ3ï¼šç¼–è¯‘æ—¶ vs è¿è¡Œæ—¶å¯¹æ¯” -->
    <div class="demo-section">
      <h2>å®éªŒ3ï¼šä¸‰ç§ç¼–è¯‘/è¿è¡Œç­–ç•¥å¯¹æ¯”</h2>
      <div id="compile-runtime-demo"></div>
    </div>

    <script>
      console.log("ğŸš€ å¼€å§‹éªŒè¯Vueè®¾è®¡æƒè¡¡...");

      // ===== å®éªŒ1ï¼šå‘½ä»¤å¼ vs å£°æ˜å¼ =====
      const testData = Array.from({ length: 100 }, (_, i) => ({
        id: i,
        name: `ç”¨æˆ·${i}`,
        status: i % 2 === 0 ? "åœ¨çº¿" : "ç¦»çº¿",
      }));

      // å‘½ä»¤å¼å®ç°
      function imperativeRender(data, container) {
        console.time("å‘½ä»¤å¼è€—æ—¶");
        container.innerHTML = "";
        const ul = document.createElement("ul");

        data.forEach((item) => {
          const li = document.createElement("li");
          li.className = item.status === "åœ¨çº¿" ? "online" : "offline";
          li.textContent = `${item.name} - ${item.status}`;
          ul.appendChild(li);
        });

        container.appendChild(ul);
        console.timeEnd("å‘½ä»¤å¼è€—æ—¶");
      }

      // å£°æ˜å¼å®ç°ï¼ˆæ¨¡æ‹Ÿï¼‰
      function declarativeRender(data, container) {
        console.time("å£°æ˜å¼è€—æ—¶");
        const template = data
          .map(
            (item) =>
              `<li class="${item.status === "åœ¨çº¿" ? "online" : "offline"}">
          ${item.name} - ${item.status}
        </li>`
          )
          .join("");

        container.innerHTML = `<ul>${template}</ul>`;
        console.timeEnd("å£°æ˜å¼è€—æ—¶");
      }

      // æ‰§è¡Œå¯¹æ¯”
      imperativeRender(testData, document.getElementById("imperative-result"));
      declarativeRender(
        testData,
        document.getElementById("declarative-result")
      );

      // ===== å®éªŒ2ï¼šè™šæ‹ŸDOMæ¦‚å¿µéªŒè¯ =====
      // æ¨¡æ‹Ÿè™šæ‹ŸDOMç»“æ„
      const VNode = {
        tag: "div",
        props: { class: "container" },
        children: [
          { tag: "h3", children: ["è™šæ‹ŸDOMçš„ä¼˜åŠ¿"] },
          { tag: "p", children: ["1. å¯é¢„æµ‹çš„æ›´æ–°"] },
          { tag: "p", children: ["2. è·¨å¹³å°èƒ½åŠ›"] },
          { tag: "p", children: ["3. ç»„ä»¶åŒ–æ”¯æŒ"] },
        ],
      };

      // ç®€å•çš„è™šæ‹ŸDOMæ¸²æŸ“å™¨
      function renderVNode(vnode) {
        if (typeof vnode === "string") return document.createTextNode(vnode);

        const el = document.createElement(vnode.tag);

        if (vnode.props) {
          Object.entries(vnode.props).forEach(([key, value]) => {
            el.setAttribute(key, value);
          });
        }

        if (vnode.children) {
          vnode.children.forEach((child) => {
            el.appendChild(renderVNode(child));
          });
        }

        return el;
      }

      document
        .getElementById("virtual-dom-demo")
        .appendChild(renderVNode(VNode));

      // innerHTMLå¯¹æ¯”
      document.getElementById("inner-html-demo").innerHTML = `
      <div class="container">
        <h3>innerHTMLæ–¹å¼</h3>
        <p>1. ç®€å•ç›´æ¥</p>
        <p>2. æ€§èƒ½æ›´å¥½ï¼ˆå•æ¬¡æ¸²æŸ“ï¼‰</p>
        <p>3. ä½†éš¾ä»¥åšç²¾å‡†æ›´æ–°</p>
      </div>
    `;

      // ===== å®éªŒ3ï¼šä¸‰ç§ç­–ç•¥å¯¹æ¯” =====
      // æ¨¡æ‹Ÿç¼–è¯‘æ—¶ä¼˜åŒ–
      const compiledTemplate = {
        // ç¼–è¯‘æ—¶å·²çŸ¥çš„é™æ€éƒ¨åˆ†
        staticParts: ['<div class="user-card"><h3>', "</h3><p>çŠ¶æ€: "],
        // è¿è¡Œæ—¶åŠ¨æ€éƒ¨åˆ†çš„ä½ç½®
        dynamicSlots: [0, 1], // name, status
        // ç¼–è¯‘æ—¶ç”Ÿæˆçš„ä¼˜åŒ–æ¸²æŸ“å‡½æ•°
        render: function (data) {
          return `${this.staticParts[0]}${data.name}${this.staticParts[1]}${data.status}</p></div>`;
        },
      };

      // çº¯è¿è¡Œæ—¶æ–¹å¼ï¼ˆéœ€è¦è¿è¡Œæ—¶è§£æï¼‰
      function pureRuntime(template, data) {
        console.time("çº¯è¿è¡Œæ—¶");
        const result = template.replace(
          /\{\{(\w+)\}\}/g,
          (match, key) => data[key]
        );
        console.timeEnd("çº¯è¿è¡Œæ—¶");
        return result;
      }

      // ç¼–è¯‘æ—¶+è¿è¡Œæ—¶æ–¹å¼
      function compileRuntime(compiled, data) {
        console.time("ç¼–è¯‘æ—¶+è¿è¡Œæ—¶");
        const result = compiled.render(data);
        console.timeEnd("ç¼–è¯‘æ—¶+è¿è¡Œæ—¶");
        return result;
      }

      // æ–°å¢ï¼šçº¯ç¼–è¯‘æ—¶æ–¹å¼ï¼ˆç±»ä¼¼Svelteï¼‰
      function pureCompileTime(data, container) {
        console.time("çº¯ç¼–è¯‘æ—¶");

        // è¿™é‡Œæ¨¡æ‹Ÿç¼–è¯‘æ—¶ç”Ÿæˆçš„ä»£ç 
        // åœ¨çœŸå®çš„çº¯ç¼–è¯‘æ—¶æ¡†æ¶ä¸­ï¼Œä¸‹é¢è¿™æ®µä»£ç æ˜¯åœ¨æ„å»ºæ—¶ç”Ÿæˆçš„
        // ä¸ä¼šæœ‰æ¨¡æ¿è§£æå’Œä¸­é—´è¿‡ç¨‹ï¼Œç›´æ¥å°±æ˜¯åŸç”ŸDOMæ“ä½œ

        // æ¨¡æ‹Ÿç¼–è¯‘åçš„ä»£ç 
        const div = document.createElement("div");
        div.className = "user-card";

        const h3 = document.createElement("h3");
        // ç›´æ¥ç»‘å®šå“åº”å¼æ•°æ®è€Œä¸æ˜¯åˆ›å»ºè™šæ‹ŸDOM
        h3.textContent = data.name;
        div.appendChild(h3);

        const p = document.createElement("p");
        p.textContent = `çŠ¶æ€: ${data.status}`;
        div.appendChild(p);

        // æ¸…ç©ºå®¹å™¨å¹¶æ·»åŠ æ–°å…ƒç´ 
        if (container) {
          // åœ¨å®é™…çš„Svelteä¸­ï¼Œè¿™ä¼šæ›´æ™ºèƒ½åœ°å¤„ç†DOMæ›´æ–°
          container.innerHTML = "";
          container.appendChild(div);
        }

        console.timeEnd("çº¯ç¼–è¯‘æ—¶");
        return div.outerHTML;
      }

      // æµ‹è¯•æ•°æ®
      const userData = { name: "å¼ ä¸‰", status: "åœ¨çº¿" };
      const pureTemplate =
        '<div class="user-card"><h3>{{name}}</h3><p>çŠ¶æ€: {{status}}</p></div>';

      // æ‰§è¡Œæµ‹è¯•
      const demo3Container = document.getElementById("compile-runtime-demo");

      // åˆ›å»ºä¸€ä¸ªä¸´æ—¶å®¹å™¨ç”¨äºçº¯ç¼–è¯‘æ—¶æ¼”ç¤º
      const tempContainer = document.createElement("div");

      demo3Container.innerHTML = `
        <h4>çº¯è¿è¡Œæ—¶ç»“æœ:</h4>
        ${pureRuntime(pureTemplate, userData)}
        <h4>ç¼–è¯‘æ—¶+è¿è¡Œæ—¶ç»“æœ:</h4>
        ${compileRuntime(compiledTemplate, userData)}
        <h4>çº¯ç¼–è¯‘æ—¶ç»“æœ:</h4>
        ${pureCompileTime(userData, tempContainer)}
        <p class="performance-result">æŸ¥çœ‹æ§åˆ¶å°å¯¹æ¯”æ€§èƒ½å·®å¼‚</p>
        
        <div class="comparison">
          <h4>ä¸‰ç§æ–¹å¼çš„ç‰¹ç‚¹å¯¹æ¯”:</h4>
          <table border="1" style="border-collapse: collapse; width: 100%;">
            <tr>
              <th>æ–¹å¼</th>
              <th>ä¼˜åŠ¿</th>
              <th>åŠ£åŠ¿</th>
              <th>å…¸å‹æ¡†æ¶</th>
            </tr>
            <tr>
              <td>çº¯è¿è¡Œæ—¶</td>
              <td>æœ€çµæ´»ï¼Œæ”¯æŒåŠ¨æ€æ¨¡æ¿</td>
              <td>æ€§èƒ½è¾ƒä½ï¼Œéœ€è¦è¿è¡Œæ—¶è§£æ</td>
              <td>æ—©æœŸVue1.x</td>
            </tr>
            <tr>
              <td>ç¼–è¯‘æ—¶+è¿è¡Œæ—¶</td>
              <td>å¹³è¡¡çµæ´»æ€§å’Œæ€§èƒ½</td>
              <td>æ„å»ºè¿‡ç¨‹å¤æ‚</td>
              <td>Vue3, React</td>
            </tr>
            <tr>
              <td>çº¯ç¼–è¯‘æ—¶</td>
              <td>ç†è®ºä¸Šæ€§èƒ½æœ€ä½³ï¼Œä½“ç§¯å°</td>
              <td>çµæ´»æ€§å—é™ï¼ŒåŠ¨æ€å†…å®¹æ”¯æŒå¼±</td>
              <td>Svelte</td>
            </tr>
          </table>
        </div>
      `;

      // å¤šæ¬¡æ‰§è¡Œä»¥æ¯”è¾ƒæ€§èƒ½å·®å¼‚
      console.log("===== å¤šæ¬¡æ‰§è¡Œæ€§èƒ½å¯¹æ¯” =====");
      console.log("çº¯è¿è¡Œæ—¶ vs ç¼–è¯‘æ—¶+è¿è¡Œæ—¶ vs çº¯ç¼–è¯‘æ—¶:");

      console.log("ç¬¬1è½®:");
      pureRuntime(pureTemplate, userData);
      compileRuntime(compiledTemplate, userData);
      pureCompileTime(userData, tempContainer);

      console.log("ç¬¬2è½®:");
      pureRuntime(pureTemplate, userData);
      compileRuntime(compiledTemplate, userData);
      pureCompileTime(userData, tempContainer);

      console.log("ç¬¬3è½®:");
      pureRuntime(pureTemplate, userData);
      compileRuntime(compiledTemplate, userData);
      pureCompileTime(userData, tempContainer);

      // ğŸ¤” æ€è€ƒé¢˜è¾“å‡º
      console.log(`
      ğŸ¤” æ€è€ƒé¢˜ï¼š
      1. ä»æ€§èƒ½æµ‹è¯•ç»“æœçœ‹ï¼Œæ‚¨è®¤ä¸ºVueé€‰æ‹©å£°æ˜å¼çš„ä¸»è¦åŸå› æ˜¯ä»€ä¹ˆï¼Ÿ
      2. è™šæ‹ŸDOMç›¸æ¯”ç›´æ¥DOMæ“ä½œï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä¼˜åŠ¿æœ€æ˜æ˜¾ï¼Ÿ
      3. ä¸ºä»€ä¹ˆVueæ²¡æœ‰é€‰æ‹©çº¯ç¼–è¯‘æ—¶æ–¹æ¡ˆè€Œæ˜¯é€‰æ‹©ç¼–è¯‘æ—¶+è¿è¡Œæ—¶ï¼Ÿ
      4. åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ï¼ŒSvelteçš„çº¯ç¼–è¯‘æ—¶æ–¹æ¡ˆå¯èƒ½æ¯”Vueæ›´æœ‰ä¼˜åŠ¿ï¼Ÿ
      
      è¯·åœ¨å­¦ä¹ ç¬”è®°ä¸­è®°å½•æ‚¨çš„ç­”æ¡ˆ...
      `);
    </script>
  </body>
</html>
