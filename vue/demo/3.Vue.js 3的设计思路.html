<!DOCTYPE html>
<html>
  <head>
    <title>ç¬¬3ç« ï¼šVue.js 3è®¾è®¡æ€è·¯-å®è·µéªŒè¯</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .demo-section {
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px 0;
      }
      .result {
        color: #007acc;
        font-weight: bold;
      }
      pre {
        background-color: #f5f5f5;
        padding: 10px;
        overflow: auto;
      }
    </style>
  </head>
  <body>
    <h1>Vue.js 3è®¾è®¡æ€è·¯éªŒè¯</h1>

    <!-- å®éªŒ1ï¼šå£°æ˜å¼UIæè¿° -->
    <div class="demo-section">
      <h2>å®éªŒ1ï¼šå£°æ˜å¼UIæè¿° - æ¨¡æ¿ vs Renderå‡½æ•°</h2>
      <div id="template-demo"></div>
      <div id="render-demo"></div>
    </div>

    <!-- å®éªŒ2ï¼šæ¸²æŸ“å™¨è®¾è®¡ -->
    <div class="demo-section">
      <h2>å®éªŒ2ï¼šæ¸²æŸ“å™¨æ ¸å¿ƒè®¾è®¡</h2>
      <div id="renderer-demo"></div>
    </div>

    <!-- å®éªŒ3ï¼šç»„ä»¶åŒ–æœºåˆ¶ -->
    <div class="demo-section">
      <h2>å®éªŒ3ï¼šç»„ä»¶åŒ–æœºåˆ¶</h2>
      <div id="component-demo"></div>
    </div>

    <script>
      console.log("ğŸš€ å¼€å§‹éªŒè¯Vue.js 3è®¾è®¡æ€è·¯...");

      // ===== å®éªŒ1ï¼šå£°æ˜å¼UIæè¿° =====
      // æ¨¡æ‹ŸVueçš„ä¸¤ç§UIæè¿°æ–¹å¼ï¼šæ¨¡æ¿å’Œæ¸²æŸ“å‡½æ•°

      // 1. æ¨¡æ¿æ–¹å¼ï¼ˆå£°æ˜å¼ï¼‰
      const templateDemo = document.getElementById("template-demo");
      templateDemo.innerHTML = `
      <h3>æ¨¡æ¿æ–¹å¼ï¼ˆå£°æ˜å¼ï¼‰</h3>
      <pre>
&lt;template&gt;
  &lt;div class="user-card"&gt;
    &lt;h4&gt;{{ user.name }}&lt;/h4&gt;
    &lt;p&gt;{{ user.role }}&lt;/p&gt;
    &lt;button @click="handleClick"&gt;æŸ¥çœ‹è¯¦æƒ…&lt;/button&gt;
  &lt;/div&gt;
&lt;/template&gt;
      </pre>
      <p class="result">ğŸ‘† å…³æ³¨"ç»“æœ"ï¼Œæè¿°UIçš„æœ€ç»ˆçŠ¶æ€ï¼Œç”±Vueå†…éƒ¨å¤„ç†å®ç°ç»†èŠ‚</p>
    `;

      // 2. æ¸²æŸ“å‡½æ•°æ–¹å¼ï¼ˆæ›´æ¥è¿‘å‘½ä»¤å¼ï¼Œä½†ä»æ˜¯å£°æ˜å¼ï¼‰
      const renderDemo = document.getElementById("render-demo");
      renderDemo.innerHTML = `
      <h3>æ¸²æŸ“å‡½æ•°æ–¹å¼</h3>
      <pre>
render() {
  return h('div', { class: 'user-card' }, [
    h('h4', null, this.user.name),
    h('p', null, this.user.role),
    h('button', { onClick: this.handleClick }, 'æŸ¥çœ‹è¯¦æƒ…')
  ])
}
      </pre>
      <p class="result">ğŸ‘† æ›´çµæ´»ï¼Œä½†éœ€è¦æ‰‹åŠ¨æ„å»ºè™šæ‹ŸDOMç»“æ„</p>
    `;

      // ===== å®éªŒ2ï¼šæ¸²æŸ“å™¨è®¾è®¡ =====
      // æ¨¡æ‹ŸVueæ¸²æŸ“å™¨çš„æ ¸å¿ƒè®¾è®¡

      const rendererDemo = document.getElementById("renderer-demo");
      rendererDemo.innerHTML = `
      <h3>æ¸²æŸ“å™¨æ ¸å¿ƒè®¾è®¡</h3>
      <pre>
// åˆ›å»ºæ¸²æŸ“å™¨ - å¹³å°æ— å…³çš„è®¾è®¡
function createRenderer(options) {
  // å¹³å°ç‰¹å®šAPI
  const {
    createElement,   // åˆ›å»ºå…ƒç´ 
    setElementText,  // è®¾ç½®å…ƒç´ æ–‡æœ¬
    insert,          // æ’å…¥å…ƒç´ 
    patchProp,       // è®¾ç½®å±æ€§
    // ...å…¶ä»–API
  } = options;
  
  // æ¸²æŸ“å‡½æ•° - å°†è™šæ‹ŸDOMæ¸²æŸ“ä¸ºçœŸå®DOM
  function render(vnode, container) {
    if (vnode) {
      // æœ‰æ–°vnodeï¼Œæ‰§è¡Œpatch
      patch(container._vnode, vnode, container);
    } else {
      // æ²¡æœ‰æ–°vnodeï¼Œå¸è½½æ—§vnode
      if (container._vnode) {
        unmount(container._vnode);
      }
    }
    // ä¿å­˜å½“å‰vnodeåˆ°å®¹å™¨
    container._vnode = vnode;
  }
  
  // patchå‡½æ•° - å¤„ç†DOMæ›´æ–°
  function patch(oldVNode, newVNode, container) {
    // DOMæ›´æ–°é€»è¾‘...
  }
  
  // è¿”å›æ¸²æŸ“å™¨
  return {
    render
  };
}

// åˆ›å»ºæµè§ˆå™¨æ¸²æŸ“å™¨
const renderer = createRenderer({
  createElement: (tag) => document.createElement(tag),
  setElementText: (el, text) => el.textContent = text,
  insert: (el, parent, anchor) => parent.insertBefore(el, anchor || null),
  // ...å…¶ä»–API
});
      </pre>
      <p class="result">ğŸ‘† é€šè¿‡å°†å¹³å°APIæŠ½è±¡ä¸ºé…ç½®é¡¹ï¼Œä½¿æ¸²æŸ“å™¨ä¸å¹³å°è§£è€¦</p>
    `;

      // ===== å®éªŒ3ï¼šç»„ä»¶åŒ–æœºåˆ¶ =====
      // æ¨¡æ‹ŸVueç»„ä»¶çš„æœ¬è´¨å’Œæ¸²æŸ“æµç¨‹

      const componentDemo = document.getElementById("component-demo");
      componentDemo.innerHTML = `
      <h3>ç»„ä»¶åŒ–æœºåˆ¶</h3>
      <pre>
// ç»„ä»¶çš„æœ¬è´¨ï¼šè¿”å›è™šæ‹ŸDOMæ ‘çš„å‡½æ•°æˆ–å¯¹è±¡
const MyComponent = {
  // dataå‡½æ•°è¿”å›å“åº”å¼æ•°æ®
  data() {
    return { count: 0 }
  },
  
  // æ¨¡æ¿ç¼–è¯‘æˆçš„æ¸²æŸ“å‡½æ•°
  render() {
    return h('div', { class: 'my-component' }, [
      h('p', null, \`Count: \${this.count}\`),
      h('button', { onClick: () => this.count++ }, 'Increment')
    ])
  }
};

// ç»„ä»¶vnode
const compVNode = h(MyComponent, { prop: 'value' });

// ç»„ä»¶æ¸²æŸ“æµç¨‹
// 1. åˆ›å»ºç»„ä»¶å®ä¾‹
// 2. è®¾ç½®ç»„ä»¶çŠ¶æ€
// 3. æ‰§è¡Œæ¸²æŸ“å‡½æ•°ï¼Œå¾—åˆ°å­æ ‘vnode
// 4. æ¸²æŸ“å­æ ‘vnodeåˆ°DOM
      </pre>
      <p class="result">ğŸ‘† ç»„ä»¶æœ¬è´¨æ˜¯ä¸€ç»„DOMå…ƒç´ çš„å°è£…ï¼Œæ¸²æŸ“æµç¨‹ï¼štemplateâ†’renderå‡½æ•°â†’è™šæ‹ŸDOMâ†’çœŸå®DOM</p>
      <div>
        <h4>å®Œæ•´æ¶æ„æµç¨‹å›¾ï¼š</h4>
        <pre>
ç”¨æˆ·ç•Œé¢(æ¨¡æ¿/JSX)
     â†“
ç¼–è¯‘å™¨(Compiler) â†’ ä¼˜åŒ–(é™æ€æå‡ã€Blockæ ‘)
     â†“
æ¸²æŸ“å‡½æ•°(Render Function)
     â†“
å“åº”å¼ç³»ç»Ÿ(Reactivity)
     â†“
è™šæ‹ŸDOM(Virtual DOM)
     â†“
æ¸²æŸ“å™¨(Renderer)
     â†“
çœŸå®DOM/å…¶ä»–å¹³å°
        </pre>
      </div>
    `;

      // ğŸ¤” æ€è€ƒé¢˜è¾“å‡º
      console.log(`
    ğŸ¤” æ€è€ƒé¢˜ï¼š
    1. Vueçš„æ¶æ„è®¾è®¡ä¸Reactç›¸æ¯”æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
    2. ä¸ºä»€ä¹ˆVueçš„æ¸²æŸ“å™¨è¦è®¾è®¡æˆå¹³å°æ— å…³çš„ï¼Ÿ
    3. ç»„ä»¶åŒ–ä¸ºä»€ä¹ˆæ˜¯ç°ä»£å‰ç«¯æ¡†æ¶çš„æ ¸å¿ƒï¼Ÿ
    
    è¯·åœ¨å­¦ä¹ ç¬”è®°ä¸­è®°å½•æ‚¨çš„ç­”æ¡ˆ...
    `);
    </script>
  </body>
</html>
