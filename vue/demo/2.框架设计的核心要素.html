<!DOCTYPE html>
<html>
  <head>
    <title>ç¬¬2ç« æ¡†æ¶è®¾è®¡æ ¸å¿ƒè¦ç´ -å®è·µéªŒè¯</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .demo-section {
        border: 1px solid #ccc;
        padding: 15px;
        margin: 10px 0;
      }
      .result {
        color: #007acc;
        font-weight: bold;
      }
      .error {
        color: red;
      }
    </style>
  </head>
  <body>
    <h1>Vueæ¡†æ¶è®¾è®¡æ ¸å¿ƒè¦ç´ éªŒè¯</h1>

    <!-- å®éªŒ1ï¼šç¯å¢ƒå˜é‡æ§åˆ¶æ¼”ç¤º -->
    <div class="demo-section">
      <h2>å®éªŒ1ï¼šç¯å¢ƒå˜é‡æ§åˆ¶</h2>
      <div id="env-var-demo"></div>
    </div>

    <!-- å®éªŒ2ï¼šé”™è¯¯å¤„ç†æœºåˆ¶ -->
    <div class="demo-section">
      <h2>å®éªŒ2ï¼šç»Ÿä¸€é”™è¯¯å¤„ç†</h2>
      <div id="error-handling-demo"></div>
    </div>

    <!-- å®éªŒ3ï¼šTreeShakingæµ‹è¯• -->
    <div class="demo-section">
      <h2>å®éªŒ3ï¼šTreeShakingæ¦‚å¿µæ¼”ç¤º</h2>
      <div id="tree-shaking-demo"></div>
    </div>

    <script>
      console.log("ğŸš€ å¼€å§‹éªŒè¯Vueæ¡†æ¶è®¾è®¡æ ¸å¿ƒè¦ç´ ...");

      // ===== å®éªŒ1ï¼šç¯å¢ƒå˜é‡æ§åˆ¶ =====
      // æ¨¡æ‹ŸVueçš„ç¯å¢ƒå˜é‡æ§åˆ¶
      const __DEV__ = true; // æ¨¡æ‹Ÿå¼€å‘ç¯å¢ƒ

      function warn(msg) {
        if (__DEV__) {
          console.warn(`[Vue warn]: ${msg}`);
          document.getElementById("env-var-demo").innerHTML += `
          <p class="result">è­¦å‘Šä¿¡æ¯(å¼€å‘ç¯å¢ƒ): ${msg}</p>
        `;
        }
      }

      function createApp(options) {
        if (__DEV__ && !options) {
          warn("App options cannot be empty");
        }
        // åº”ç”¨åˆ›å»ºé€»è¾‘...
        return { mount: () => console.log("App mounted") };
      }

      // æµ‹è¯•
      createApp(); // åº”è¯¥æ˜¾ç¤ºè­¦å‘Š
      createApp({}); // ä¸åº”æ˜¾ç¤ºè­¦å‘Š

      // ===== å®éªŒ2ï¼šé”™è¯¯å¤„ç†æœºåˆ¶ =====
      // æ¨¡æ‹ŸVueçš„ç»Ÿä¸€é”™è¯¯å¤„ç†
      const errorHandlingDemo = document.getElementById("error-handling-demo");

      // å…¨å±€é”™è¯¯å¤„ç†å™¨
      let globalErrorHandler = (err) => {
        console.error("é»˜è®¤é”™è¯¯å¤„ç†:", err);
        errorHandlingDemo.innerHTML += `<p class="error">é»˜è®¤é”™è¯¯å¤„ç†: ${err.message}</p>`;
      };

      // è®¾ç½®è‡ªå®šä¹‰é”™è¯¯å¤„ç†å™¨
      function setErrorHandler(handler) {
        globalErrorHandler = handler;
      }

      // ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å‡½æ•°
      function callWithErrorHandling(fn, context, args, errorInfo) {
        try {
          return fn.apply(context, args);
        } catch (err) {
          globalErrorHandler(err, errorInfo);
        }
      }

      // æµ‹è¯•ä¸åŒç±»å‹çš„é”™è¯¯
      function testErrorHandling() {
        // 1. ä½¿ç”¨é»˜è®¤é”™è¯¯å¤„ç†
        callWithErrorHandling(
          () => {
            throw new Error("ç»„ä»¶æ¸²æŸ“é”™è¯¯");
          },
          null,
          [],
          { component: "TestComponent" }
        );

        // 2. è®¾ç½®è‡ªå®šä¹‰é”™è¯¯å¤„ç†
        setErrorHandler((err, info) => {
          console.log("è‡ªå®šä¹‰é”™è¯¯å¤„ç†:", err, info);
          errorHandlingDemo.innerHTML += `
          <p class="result">è‡ªå®šä¹‰é”™è¯¯å¤„ç†: ${err.message}</p>
          <p>ç»„ä»¶: ${info.component}</p>
        `;
        });

        // 3. å†æ¬¡è§¦å‘é”™è¯¯
        callWithErrorHandling(
          () => {
            throw new Error("ç”Ÿå‘½å‘¨æœŸé’©å­é”™è¯¯");
          },
          null,
          [],
          { component: "AnotherComponent", hook: "mounted" }
        );
      }

      testErrorHandling();

      // ===== å®éªŒ3ï¼šTreeShakingæ¦‚å¿µæ¼”ç¤º =====
      const treeShakerDemo = document.getElementById("tree-shaking-demo");

      // æ¨¡æ‹Ÿå¯Tree-Shakingçš„APIè®¾è®¡
      const utils = {
        // ä½¿ç”¨/*#__PURE__*/æ ‡è®°ï¼Œè¡¨ç¤ºæ— å‰¯ä½œç”¨
        /*#__PURE__*/
        deepClone(obj) {
          return JSON.parse(JSON.stringify(obj));
        },

        // å¯¼å‡ºç‹¬ç«‹å‡½æ•°è€Œéæ–¹æ³•
        formatDate(date) {
          return new Date(date).toLocaleDateString();
        },
      };

      // æ¨¡æ‹Ÿä½¿ç”¨éƒ¨åˆ†API
      function demoTreeShaking() {
        const data = { name: "Vue", version: "3.0" };
        const cloned = utils.deepClone(data);

        treeShakerDemo.innerHTML = `
        <p>åŸå§‹æ•°æ®: ${JSON.stringify(data)}</p>
        <p>å…‹éš†ç»“æœ: ${JSON.stringify(cloned)}</p>
        <p class="result">æ³¨æ„: åœ¨å®é™…æ„å»ºä¸­ï¼Œæœªä½¿ç”¨çš„formatDateå‡½æ•°å°†è¢«Tree-Shakingåˆ é™¤</p>
        <pre>
// è‰¯å¥½çš„Tree-Shakingè®¾è®¡:
export function useA() {}  // æœªä½¿ç”¨æ—¶ä¼šè¢«ç§»é™¤
export function useB() {}  // æœªä½¿ç”¨æ—¶ä¼šè¢«ç§»é™¤

// ä¸åˆ©äºTree-Shakingçš„è®¾è®¡:
export default {
  useA() {},  // å³ä½¿æœªä½¿ç”¨ï¼Œä¹Ÿä¼šè¢«æ‰“åŒ…
  useB() {}   // å³ä½¿æœªä½¿ç”¨ï¼Œä¹Ÿä¼šè¢«æ‰“åŒ…
}
        </pre>
      `;
      }

      demoTreeShaking();
    </script>
  </body>
</html>
